<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å…¨å±€è¨­å®šç¤ºä¾‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    .card { background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .card h3 { margin: 0 0 15px 0; color: #2d2320; border-bottom: 2px solid #e0b873; padding-bottom: 10px; }
    .setting-item { margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px; }
    .setting-label { font-weight: bold; color: #2d2320; }
    .setting-value { color: #666; margin-left: 10px; }
    .status { padding: 8px 16px; border-radius: 20px; color: white; font-weight: bold; display: inline-block; }
    .status.open { background: #4CAF50; }
    .status.closed { background: #f44336; }
    .btn { padding: 8px 16px; background: #e0b873; color: #2d2320; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin: 5px; }
    .btn:hover { background: #d4a862; }
    .loading { text-align: center; color: #666; margin: 20px 0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h3>ğŸŒ å…¨å±€è¨­å®šç³»çµ±ç¤ºä¾‹</h3>
      <p>é€™å€‹é é¢å±•ç¤ºäº†å…¨å±€è¨­å®šç³»çµ±å¦‚ä½•åœ¨æ•´å€‹æ‡‰ç”¨ä¸­å…±äº«è¨­å®šè³‡è¨Šã€‚</p>
      <button class="btn" onclick="loadSettings()">é‡æ–°è¼‰å…¥è¨­å®š</button>
      <button class="btn" onclick="checkBusinessStatus()">æª¢æŸ¥ç‡Ÿæ¥­ç‹€æ…‹</button>
    </div>

    <div id="settingsContent" class="loading">è¼‰å…¥è¨­å®šä¸­...</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    import globalSettings from './global_settings.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDSKEpN_xclOhuWOQA7HiMSjsz0lNIHRb4",
      authDomain: "gukediancan.firebaseapp.com",
      projectId: "gukediancan",
      storageBucket: "gukediancan.firebasestorage.app",
      messagingSenderId: "864103354539",
      appId: "1:864103354539:web:26aabd0cc698d7a032e7ee",
      measurementId: "G-EZYMQQ5FGQ"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // è¼‰å…¥ä¸¦é¡¯ç¤ºè¨­å®š
    async function loadSettings() {
      const content = document.getElementById('settingsContent');
      content.innerHTML = '<div class="loading">è¼‰å…¥è¨­å®šä¸­...</div>';
      
      try {
        await globalSettings.initialize(db);
        displaySettings();
      } catch (error) {
        console.error('è¼‰å…¥è¨­å®šå¤±æ•—:', error);
        content.innerHTML = '<div style="color: #f44336;">è¼‰å…¥è¨­å®šå¤±æ•—ï¼š' + error.message + '</div>';
      }
    }

    // é¡¯ç¤ºè¨­å®šè³‡è¨Š
    function displaySettings() {
      const content = document.getElementById('settingsContent');
      
      // æ›´æ–°é é¢æ¨™é¡Œ
      document.title = `${globalSettings.getStoreName()} - å…¨å±€è¨­å®šç¤ºä¾‹`;
      
      let html = '';
      
      // åº—å®¶è³‡è¨Š
      html += '<div class="card">';
      html += '<h3>ğŸª åº—å®¶è³‡è¨Š</h3>';
      html += '<div class="setting-item">';
      html += '<span class="setting-label">åº—å®¶åç¨±ï¼š</span>';
      html += '<span class="setting-value">' + globalSettings.getStoreName() + '</span>';
      html += '</div>';
      
      const storeInfo = globalSettings.get('store_info');
      if (storeInfo) {
        if (storeInfo.address) {
          html += '<div class="setting-item">';
          html += '<span class="setting-label">åœ°å€ï¼š</span>';
          html += '<span class="setting-value">' + storeInfo.address + '</span>';
          html += '</div>';
        }
        if (storeInfo.phone) {
          html += '<div class="setting-item">';
          html += '<span class="setting-label">é›»è©±ï¼š</span>';
          html += '<span class="setting-value">' + storeInfo.phone + '</span>';
          html += '</div>';
        }
      }
      html += '</div>';
      
      // ç³»çµ±åƒæ•¸
      html += '<div class="card">';
      html += '<h3>âš™ï¸ ç³»çµ±åƒæ•¸</h3>';
      html += '<div class="setting-item">';
      html += '<span class="setting-label">åˆ·æ–°é–“éš”ï¼š</span>';
      html += '<span class="setting-value">' + globalSettings.getRefreshInterval() + ' ç§’</span>';
      html += '</div>';
      
      const takeoutRange = globalSettings.getTakeoutNumberRange();
      html += '<div class="setting-item">';
      html += '<span class="setting-label">å–é¤è™Ÿç¢¼ç¯„åœï¼š</span>';
      html += '<span class="setting-value">' + takeoutRange.min + ' - ' + takeoutRange.max + '</span>';
      html += '</div>';
      
      html += '<div class="setting-item">';
      html += '<span class="setting-label">ä½åº«å­˜é–¾å€¼ï¼š</span>';
      html += '<span class="setting-value">' + globalSettings.getLowStockThreshold() + '%</span>';
      html += '</div>';
      
      html += '<div class="setting-item">';
      html += '<span class="setting-label">éŸ³æ•ˆæé†’ï¼š</span>';
      html += '<span class="setting-value">' + (globalSettings.isSoundEnabled() ? 'âœ… å•Ÿç”¨' : 'âŒ åœç”¨') + '</span>';
      html += '</div>';
      
      html += '<div class="setting-item">';
      html += '<span class="setting-label">è‡ªå‹•åº«å­˜æ‰£æ¸›ï¼š</span>';
      html += '<span class="setting-value">' + (globalSettings.isAutoDeductionEnabled() ? 'âœ… å•Ÿç”¨' : 'âŒ åœç”¨') + '</span>';
      html += '</div>';
      html += '</div>';
      
      // åˆ—å°è¨­å®š
      html += '<div class="card">';
      html += '<h3>ğŸ–¨ï¸ åˆ—å°è¨­å®š</h3>';
      const printSettings = globalSettings.getPrintSettings();
      html += '<div class="setting-item">';
      html += '<span class="setting-label">å‡ºå–®æ©Ÿå¯¬åº¦ï¼š</span>';
      html += '<span class="setting-value">' + printSettings.printerWidth + 'mm</span>';
      html += '</div>';
      html += '<div class="setting-item">';
      html += '<span class="setting-label">å­—é«”å¤§å°ï¼š</span>';
      html += '<span class="setting-value">' + printSettings.printFontSize + 'px</span>';
      html += '</div>';
      html += '<div class="setting-item">';
      html += '<span class="setting-label">è‡ªå‹•åˆ—å°ï¼š</span>';
      html += '<span class="setting-value">' + (printSettings.autoPrint ? 'âœ… å•Ÿç”¨' : 'âŒ åœç”¨') + '</span>';
      html += '</div>';
      html += '</div>';
      
      // ç‡Ÿæ¥­ç‹€æ…‹
      html += '<div class="card">';
      html += '<h3>ğŸ• ç‡Ÿæ¥­ç‹€æ…‹</h3>';
      html += '<div class="setting-item">';
      html += '<span class="setting-label">ä»Šæ—¥ç‡Ÿæ¥­ï¼š</span>';
      html += '<span class="setting-value">' + (globalSettings.isOpenToday() ? 'âœ… ç‡Ÿæ¥­' : 'âŒ ä¼‘æ¯') + '</span>';
      html += '</div>';
      
      const todayHours = globalSettings.getTodayBusinessHours();
      html += '<div class="setting-item">';
      html += '<span class="setting-label">ç‡Ÿæ¥­æ™‚é–“ï¼š</span>';
      html += '<span class="setting-value">' + todayHours.open + ' - ' + todayHours.close + '</span>';
      html += '</div>';
      
      html += '<div class="setting-item">';
      html += '<span class="setting-label">ç›®å‰ç‹€æ…‹ï¼š</span>';
      const isOpen = globalSettings.isCurrentlyOpen();
      html += '<span class="status ' + (isOpen ? 'open' : 'closed') + '">';
      html += isOpen ? 'ğŸŸ¢ ç‡Ÿæ¥­ä¸­' : 'ğŸ”´ ä¼‘æ¯ä¸­';
      html += '</span>';
      html += '</div>';
      html += '</div>';
      
      content.innerHTML = html;
    }

    // æª¢æŸ¥ç‡Ÿæ¥­ç‹€æ…‹
    function checkBusinessStatus() {
      const isOpen = globalSettings.isCurrentlyOpen();
      const todayHours = globalSettings.getTodayBusinessHours();
      
      let message = 'ğŸ“ ç‡Ÿæ¥­ç‹€æ…‹æª¢æŸ¥\n\n';
      message += `ä»Šæ—¥ç‡Ÿæ¥­ï¼š${globalSettings.isOpenToday() ? 'æ˜¯' : 'å¦'}\n`;
      message += `ç‡Ÿæ¥­æ™‚é–“ï¼š${todayHours.open} - ${todayHours.close}\n`;
      message += `ç›®å‰æ™‚é–“ï¼š${new Date().toLocaleTimeString('zh-TW')}\n`;
      message += `ç›®å‰ç‹€æ…‹ï¼š${isOpen ? 'ğŸŸ¢ ç‡Ÿæ¥­ä¸­' : 'ğŸ”´ ä¼‘æ¯ä¸­'}`;
      
      alert(message);
    }

    // ç›£è½è¨­å®šæ›´æ–°äº‹ä»¶
    window.addEventListener('globalSettingsUpdated', function(event) {
      console.log('è¨­å®šå·²æ›´æ–°:', event.detail);
      displaySettings();
    });

    // å…¨åŸŸå‡½æ•¸
    window.loadSettings = loadSettings;
    window.checkBusinessStatus = checkBusinessStatus;

    // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
    window.onload = function() {
      loadSettings();
    };
  </script>
</body>
</html> 